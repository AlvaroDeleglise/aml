

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Parameter Tuning and AutoML &#8212; Applied Machine Learning in Python</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced Topics" href="../05-advanced-topics/index.html" />
    <link rel="prev" title="Cluster Stability" href="17-cluster-evaluation.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Applied Machine Learning in Python</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../index.html">1. Welcome</a>
  </li>
  <li class="">
    <a href="../00-introduction/00-introduction.html">2. Introduction</a>
  </li>
  <li class="">
    <a href="../01-ml-workflow/00-ml-workflow.html">3. The Machine Learning Workflow</a>
  </li>
  <li class="">
    <a href="../02-supervised-learning/index.html">4. Supervised Learning Algorithms</a>
  </li>
  <li class="">
    <a href="../03-unsupervised-learning/index.html">5. Unsupervised Learning Algorithms</a>
  </li>
  <li class="active">
    <a href="index.html">6. Model Evaluation</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="1-data-splitting-strategies.html">6.1 Data Splitting Strategies</a>
    </li>
    <li class="">
      <a href="10-evaluation-metrics.html">6.2 Evaluation Metrics and scoring</a>
    </li>
    <li class="">
      <a href="11-calibration.html">6.3 Calibration</a>
    </li>
    <li class="">
      <a href="12-interpretation.html">6.4 Feature importances and Model interpretation</a>
    </li>
    <li class="">
      <a href="17-cluster-evaluation.html">6.5 Cluster Stability</a>
    </li>
    <li class="active">
      <a href="">6.6 Parameter Tuning and AutoML</a>
    </li>
  </ul>
  </li>
  <li class="">
    <a href="../05-advanced-topics/index.html">7. Advanced Topics</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../_sources/04-model-evaluation/parameter_tuning_automl.ipynb.txt"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/04-model-evaluation/parameter_tuning_automl.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="../_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                
            </div>
        </div>
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#training-size-in-svc" class="nav-link">training size in SVC</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id1" class="nav-link">Parameter Tuning and AutoML</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#motivation" class="nav-link">Motivation</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#conditional-hyper-parameters" class="nav-link">Conditional Hyper-Parameters</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#formulating-model-selection-as-hyperparameter-optimization" class="nav-link">Formulating model-selection as Hyperparameter Optimization</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#cash-problem" class="nav-link">CASH problem</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#issues-with-grid-search" class="nav-link">Issues with Grid-Search</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#black-box-search-procedures" class="nav-link">Black-Box Search Procedures</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#random-search" class="nav-link">Random Search</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#random-search-with-scikit-learn" class="nav-link">Random Search with scikit-learn</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#bayesian-optimization-smbo" class="nav-link">Bayesian Optimization, SMBO</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#surrogate-functions" class="nav-link">Surrogate functions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#evolutionary-methods-tpot" class="nav-link">Evolutionary Methods: TPOT</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#implementations" class="nav-link">Implementations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#criticism" class="nav-link">Criticism</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#beyond-black-box" class="nav-link">Beyond Black-Box</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#multi-fidelity-search" class="nav-link">Multi-Fidelity Search</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#multi-fidelity-bayesian-optimization" class="nav-link">Multi-Fidelity Bayesian Optimization</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#successive-halving" class="nav-link">Successive Halving</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#successive-halving-example" class="nav-link">Successive Halving Example</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#successive-halving-different-example" class="nav-link">Successive Halving (different) Example</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#hyperband" class="nav-link">Hyperband</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id2" class="nav-link">Hyperband</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#bohb-hpbandster" class="nav-link">BOHB / HpBandSter</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#in-practice" class="nav-link">In Practice</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#meta-learning" class="nav-link">Meta-learning</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#learning-from-experience-other-datasets" class="nav-link">Learning from experience (other datasets)</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#ranking" class="nav-link">Ranking</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#portfolios" class="nav-link">Portfolios</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#discretization" class="nav-link">Discretization</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#are-continuous-parameters-actually-important" class="nav-link">Are continuous parameters actually important ?</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#meta-features-and-meta-models" class="nav-link">Meta-Features and Meta-Models</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#active-testing-and-recommendations" class="nav-link">Active Testing and Recommendations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#multi-task-bayesian-optimization" class="nav-link">Multi-Task Bayesian Optimization</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#ensemble-models" class="nav-link">Ensemble Models</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#auto-sklearn" class="nav-link">Auto-sklearn</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#playing-around-with-auto-sklearn" class="nav-link">Playing around with auto-sklearn</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#practical-recommendations" class="nav-link">Practical Recommendations</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#seems-promising" class="nav-link">Seems promising:</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#criticisms" class="nav-link">Criticisms</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#dabl" class="nav-link">dabl</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#https-dabl-github-io" class="nav-link">https://dabl.github.io/</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#questions" class="nav-link">Questions ?</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;savefig.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;savefig.bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;tight&quot;</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">randint</span> <span class="k">as</span> <span class="n">sp_randint</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_digits</span><span class="p">,</span> <span class="n">fetch_openml</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Memory</span>

<span class="n">mem</span> <span class="o">=</span> <span class="n">Memory</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="s1">&#39;/tmp&#39;</span><span class="p">)</span>

<span class="c1"># get some data</span>
<span class="n">digits</span> <span class="o">=</span> <span class="n">load_digits</span><span class="p">()</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">digits</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">digits</span><span class="o">.</span><span class="n">target</span>
<span class="nd">@mem</span><span class="o">.</span><span class="n">cache</span>
<span class="k">def</span> <span class="nf">bla</span><span class="p">():</span>
    <span class="n">mnist</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="s2">&quot;mnist_784&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mnist</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">mnist</span><span class="o">.</span><span class="n">target</span>

<span class="c1"># X, y = bla()</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="parameter-tuning-and-automl">
<h1>Parameter Tuning and AutoML<a class="headerlink" href="#parameter-tuning-and-automl" title="Permalink to this headline">¶</a></h1>
<div class="section" id="training-size-in-svc">
<h2>training size in SVC<a class="headerlink" href="#training-size-in-svc" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id1">
<h2>Parameter Tuning and AutoML<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>03/30/20</p>
<p>Andreas C. Müller</p>
<p>FIXME successive halving and hyperband explaination with budget is too confusing, don’t need it
FIXME add neural networks to meta-model
FIXME bullet points
FIXME show figure 2x random is as good as hyperband?
FIXME needs lots more polish!
FIXME too long?! what?! how?!
FIXME difference between hyperband and SuccessiveHalving unclear</p>
</div>
<div class="section" id="motivation">
<h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Need to select among Models</p></li>
<li><p>Need to select Hyper-Parameters</p></li>
<li><p>Need to select among preprocessing methods</p></li>
</ul>
</div>
<div class="section" id="conditional-hyper-parameters">
<h2>Conditional Hyper-Parameters<a class="headerlink" href="#conditional-hyper-parameters" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Kernels</p></li>
<li><p>Neural Nets</p></li>
<li><p>Pipelines</p></li>
</ul>
</div>
<div class="section" id="formulating-model-selection-as-hyperparameter-optimization">
<h2>Formulating model-selection as Hyperparameter Optimization<a class="headerlink" href="#formulating-model-selection-as-hyperparameter-optimization" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>One big search, many conditional Hyper-Parameters</p></li>
<li><p>Categorical, integer, continuous, conditional</p></li>
<li><p>Different distributions</p></li>
</ul>
</div>
<div class="section" id="cash-problem">
<h2>CASH problem<a class="headerlink" href="#cash-problem" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Find the best configuration</p></li>
<li><p>Global optimization on complex (high-dim?) space</p></li>
</ul>
</div>
<div class="section" id="issues-with-grid-search">
<h2>Issues with Grid-Search<a class="headerlink" href="#issues-with-grid-search" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Need to define Grid</p></li>
<li><p>Exponential in number of dims</p></li>
</ul>
</div>
<div class="section" id="black-box-search-procedures">
<h2>Black-Box Search Procedures<a class="headerlink" href="#black-box-search-procedures" title="Permalink to this headline">¶</a></h2>
<div class="math notranslate nohighlight">
\[\Lambda^* = \arg\max_\Lambda f(\Lambda)\]</div>
<p>Parameters <span class="math notranslate nohighlight">\(\Lambda\)</span>, model-evaluation <span class="math notranslate nohighlight">\(f\)</span>.</p>
<p>General optimization of unknown, non-differentiable f, possibly no-smooth.
NP Hard in general.
Function f is very slow to evaluate - think training a neural net for a week.</p>
</div>
<div class="section" id="random-search">
<h2>Random Search<a class="headerlink" href="#random-search" title="Permalink to this headline">¶</a></h2>
<p><img alt=":scale 100%" src="../_images/bergstra_random.jpeg" /></p>
</div>
<div class="section" id="random-search-with-scikit-learn">
<h2>Random Search with scikit-learn<a class="headerlink" href="#random-search-with-scikit-learn" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## specify parameters and distributions to sample from</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
              <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
              <span class="s2">&quot;min_samples_split&quot;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
              <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
              <span class="s2">&quot;criterion&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gini&quot;</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span><span class="p">]}</span>
<span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span>
                                   <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dist</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>lists or objects with <code class="docutils literal notranslate"><span class="pre">rvs</span></code> method</p></li>
<li><p>Use continuous distributions for biggest advantage</p></li>
</ul>
</div>
<div class="section" id="bayesian-optimization-smbo">
<h2>Bayesian Optimization, SMBO<a class="headerlink" href="#bayesian-optimization-smbo" title="Permalink to this headline">¶</a></h2>
<p>.wide-left-column[</p>
<ul class="simple">
<li><p>fit ‘cheap’ probabilistic function to black-box</p></li>
<li><p>pick next point using exploration / exploitation</p></li>
<li><p>Implemented as acquisition function
]
.narrow-right-column[
.center[
<img alt=":scale 110%" src="../_images/smbo.png" />
]]</p></li>
</ul>
</div>
<div class="section" id="surrogate-functions">
<h2>Surrogate functions<a class="headerlink" href="#surrogate-functions" title="Permalink to this headline">¶</a></h2>
<p><img alt=":scale 100%" src="../_images/smbo_table.png" /></p>
<p>FIXME
NEED NEURAL NETS</p>
</div>
<div class="section" id="evolutionary-methods-tpot">
<h2>Evolutionary Methods: TPOT<a class="headerlink" href="#evolutionary-methods-tpot" title="Permalink to this headline">¶</a></h2>
<p>.center[
<img alt=":scale 80%" src="../_images/tpot.png" />
]</p>
</div>
<div class="section" id="implementations">
<h2>Implementations<a class="headerlink" href="#implementations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>SMAC: Random Forest model (Hutter group)</p></li>
<li><p>spearmint: GP (Snoek et al)</p></li>
<li><p>hyperopt: TPE (Bergstra, not maintained)</p></li>
<li><p>scikit-optimize: GP, tree, etc</p></li>
<li><p>GPyOpt: GP based on GPy (Lawrence group)</p></li>
</ul>
</div>
<div class="section" id="criticism">
<h2>Criticism<a class="headerlink" href="#criticism" title="Permalink to this headline">¶</a></h2>
<p><img alt=":scale 25%" src="../_images/random_rank_chart.png" />
<img alt=":scale 25%" src="../_images/random_bar_plot_sample.png" /></p>
<p>–
<img alt=":scale 23%" src="../_images/random2x_cifar10-compare.png" />
<img alt=":scale 23%" src="../_images/random2x_mrbi-compare.png" />
<img alt=":scale 23%" src="../_images/random2x_svhn-compare.png" /></p>
<p>.smallest[http://www.argmin.net/2016/06/20/hypertuning/]</p>
<p>FIXME use newer hyperband figures!</p>
</div>
<div class="section" id="beyond-black-box">
<h2>Beyond Black-Box<a class="headerlink" href="#beyond-black-box" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Hyperparameter gradient descent</p></li>
<li><p>Multi-Fidelity optimization</p></li>
<li><p>Meta-learning</p></li>
<li><p>(others…)</p></li>
</ul>
</div>
<div class="section" id="multi-fidelity-search">
<h2>Multi-Fidelity Search<a class="headerlink" href="#multi-fidelity-search" title="Permalink to this headline">¶</a></h2>
<p>.smaller[Approximate function by similar cheaper function]
.center[
<img alt=":scale 70%" src="../_images/multi-fidelity-digits.png" />
<img alt=":scale 70%" src="../_images/multi-fidelity-digits-rf.png" /></p>
<p>]</p>
<p>Top: subsample the datasets
bottom: use less trees in forest</p>
</div>
<div class="section" id="multi-fidelity-bayesian-optimization">
<h2>Multi-Fidelity Bayesian Optimization<a class="headerlink" href="#multi-fidelity-bayesian-optimization" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fit model to performance given parameters and budget</p></li>
<li><p>Choose parameters and budget for best exploration / exploitation</p></li>
<li><p>Related to multi-armed bandits and A/B testing</p></li>
<li><p>Differences to bandits:</p>
<ul>
<li><p>non-stationary distributions</p></li>
<li><p>receiving loss (computing validation error) is expensive</p></li>
<li><p>possibly infinitely many arms (continuous parameters)</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="successive-halving">
<h2>Successive Halving<a class="headerlink" href="#successive-halving" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Given <span class="math notranslate nohighlight">\(n\)</span> configuration and budget <span class="math notranslate nohighlight">\(B\)</span></p></li>
<li><p>pick <span class="math notranslate nohighlight">\(\eta=2\)</span> or <span class="math notranslate nohighlight">\(\eta=3\)</span> (wording follows 2)</p></li>
<li><p>Each iteration, keep best halve of configurations</p></li>
<li><p>after <span class="math notranslate nohighlight">\(k=\log_\eta(n) + 1\)</span> left with single configuration.</p></li>
<li><p>initially allocate <span class="math notranslate nohighlight">\(\frac{B}{kn}\)</span> to each configuration, double each iteration (exact budget is slightly more complicated, see algorithm).
–
<img alt=":scale 70%" src="../_images/halving_algorithm.png" /></p></li>
</ul>
</div>
<div class="section" id="successive-halving-example">
<h2>Successive Halving Example<a class="headerlink" href="#successive-halving-example" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>configurations n=81</p></li>
<li><p>total budget B=20000</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="mi">81</span> <span class="n">configurations</span> <span class="k">with</span> <span class="n">resources</span>   <span class="mi">41</span>
<span class="n">train</span> <span class="mi">27</span> <span class="n">configurations</span> <span class="k">with</span> <span class="n">resources</span>  <span class="mi">123</span>
<span class="n">train</span>  <span class="mi">9</span> <span class="n">configurations</span> <span class="k">with</span> <span class="n">resources</span>  <span class="mi">370</span>
<span class="n">train</span>  <span class="mi">3</span> <span class="n">configurations</span> <span class="k">with</span> <span class="n">resources</span> <span class="mi">1111</span>
<span class="n">train</span>  <span class="mi">1</span> <span class="n">configurations</span> <span class="k">with</span> <span class="n">resources</span> <span class="mi">3333</span>
<span class="n">resources</span> <span class="n">total</span><span class="p">:</span> <span class="mi">16638</span>
</pre></div>
</div>
<p>Think about resources as in “maximum number of trees build in total” or “maximum number of data points used in total”.</p>
</div>
<div class="section" id="successive-halving-different-example">
<h2>Successive Halving (different) Example<a class="headerlink" href="#successive-halving-different-example" title="Permalink to this headline">¶</a></h2>
<p><img alt=":scale 90%" src="../_images/halving_curves.png" /></p>
</div>
<div class="section" id="hyperband">
<h2>Hyperband<a class="headerlink" href="#hyperband" title="Permalink to this headline">¶</a></h2>
<p>.center[
<img alt=":scale 78%" src="../_images/hyperband_curves.png" />
]</p>
</div>
<div class="section" id="id2">
<h2>Hyperband<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><img alt=":scale 90%" src="../_images/hyperband_algorithm.png" /></p>
</div>
<div class="section" id="bohb-hpbandster">
<h2>BOHB / HpBandSter<a class="headerlink" href="#bohb-hpbandster" title="Permalink to this headline">¶</a></h2>
<p>.center[
<img alt=":scale 85%" src="../_images/bohb_curves.png" />
]</p>
</div>
<div class="section" id="in-practice">
<h2>In Practice<a class="headerlink" href="#in-practice" title="Permalink to this headline">¶</a></h2>
<p>“With the exception of the LeNet experiment (Section 3.3) and the 117 Datasets experi-
ment (Section 4.2.1), the most aggressive bracket of SuccessiveHalving outperformed
Hyperband in all of our experiments.”
.quote_author[Li et. al.]</p>
<ul class="simple">
<li><p>Soon (?) in sklearn (<a class="reference external" href="https://github.com/scikit-learn/scikit-learn/issues/12538">discussion</a>)</p></li>
<li><p><a class="reference external" href="https://automl.github.io/HpBandSter/build/html/index.html">HpBandSter</a> distributed implementation, some custom code required</p></li>
<li><p><a class="reference external" href="https://github.com/thuijskens/scikit-hyperband">scikit-hyperband</a> looks good, but doesn’t do out-of-the-box subsampling</p></li>
<li><p>Successive halving really easy to implement yourself.</p></li>
</ul>
</div>
<div class="section" id="meta-learning">
<h2>Meta-learning<a class="headerlink" href="#meta-learning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="learning-from-experience-other-datasets">
<h3>Learning from experience (other datasets)<a class="headerlink" href="#learning-from-experience-other-datasets" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="ranking">
<h2>Ranking<a class="headerlink" href="#ranking" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Run many algorithms on large array of datasets</p></li>
<li><p>Rank by “best on average”</p></li>
</ul>
</div>
<div class="section" id="portfolios">
<h2>Portfolios<a class="headerlink" href="#portfolios" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://ml.informatik.uni-freiburg.de/papers/18-AUTOML-AutoChallenge.pdf">PoSH auto-sklearn</a></p></li>
<li><p>Create diverse set so that a good one among top k</p></li>
<li><p>Submodular optimization problem</p></li>
<li><p>greedy approximation</p></li>
</ul>
</div>
<div class="section" id="discretization">
<h2>Discretization<a class="headerlink" href="#discretization" title="Permalink to this headline">¶</a></h2>
<div class="section" id="are-continuous-parameters-actually-important">
<h3>Are continuous parameters actually important ?<a class="headerlink" href="#are-continuous-parameters-actually-important" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Anectotal evidence that it’s not.</p></li>
</ul>
</div>
</div>
<div class="section" id="meta-features-and-meta-models">
<h2>Meta-Features and Meta-Models<a class="headerlink" href="#meta-features-and-meta-models" title="Permalink to this headline">¶</a></h2>
<p>.center[
<img alt=":scale 90%" src="../_images/metalearning-diagram.png" />
]</p>
</div>
<div class="section" id="active-testing-and-recommendations">
<h2>Active Testing and Recommendations<a class="headerlink" href="#active-testing-and-recommendations" title="Permalink to this headline">¶</a></h2>
<p>.smaller[</p>
<ul class="simple">
<li><p><a class="reference external" href="https://papers.nips.cc/paper/7595-probabilistic-matrix-factorization-for-automated-machine-learning.pdf">Probabilistic Matrix Factorization for AutoML (Fusi et al)</a></p></li>
<li><p>https://github.com/rsheth80/pmf-automl/]
<img alt=":scale 90%" src="../_images/fusi_latent.png" /></p></li>
</ul>
</div>
<div class="section" id="multi-task-bayesian-optimization">
<h2>Multi-Task Bayesian Optimization<a class="headerlink" href="#multi-task-bayesian-optimization" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Create estimate over all datasets at the same time!</p></li>
<li><p>Not scalable with Gaussian Processes</p></li>
<li><p>Maybe scalable with Neural Networks?</p></li>
</ul>
</div>
<div class="section" id="ensemble-models">
<h2>Ensemble Models<a class="headerlink" href="#ensemble-models" title="Permalink to this headline">¶</a></h2>
<p><img alt=":scale 100%" src="../_images/meta-learning-ensemble.png" /></p>
</div>
<div class="section" id="auto-sklearn">
<h2>Auto-sklearn<a class="headerlink" href="#auto-sklearn" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>end-to-end auto-ml</p></li>
<li><p>seaches a fixed sklearn pipeline (4 steps)</p></li>
<li><p>Warm-starting with meta-features &amp; KNN</p></li>
<li><p>Bayesian Optimization with SMAC</p></li>
</ul>
<p>https://automl.github.io/auto-sklearn/stable/index.html</p>
</div>
<div class="section" id="playing-around-with-auto-sklearn">
<h2>Playing around with auto-sklearn<a class="headerlink" href="#playing-around-with-auto-sklearn" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">autosklearn.classification</span>
<span class="kn">import</span> <span class="nn">sklearn.model_selection</span>
<span class="kn">import</span> <span class="nn">sklearn.datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">load_digits</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> \
    <span class="n">sklearn</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">automl</span> <span class="o">=</span> <span class="n">autosklearn</span><span class="o">.</span><span class="n">classification</span><span class="o">.</span><span class="n">AutoSklearnClassifier</span><span class="p">()</span>
<span class="n">automl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">automl</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy score&quot;</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">))</span>
</pre></div>
</div>
<p>“This will run for one hour and should result in an accuracy above 0.98.”</p>
</div>
<div class="section" id="practical-recommendations">
<h2>Practical Recommendations<a class="headerlink" href="#practical-recommendations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Multi-Fidelity! Simple, effective!</p></li>
<li><p>Portfolios</p></li>
<li><p>BOHB / HpBandSter</p></li>
<li><p>auto-sklearn</p></li>
<li><p>TPot?</p></li>
</ul>
<div class="section" id="seems-promising">
<h3>Seems promising:<a class="headerlink" href="#seems-promising" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Transfering surrogates / ensembles</p></li>
<li><p>Collaborative filtering / active testing</p></li>
</ul>
</div>
</div>
<div class="section" id="criticisms">
<h2>Criticisms<a class="headerlink" href="#criticisms" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Do we need 100 classifiers?</p></li>
<li><p>Do we need Complex Pipelines?</p></li>
<li><p>Creates complex models and ensembles</p></li>
<li><p>“Making it too easy”?</p></li>
</ul>
<p>Although we already reduced the space of considered ML algorithms substantially compared to our previous Auto-sklearn (4 vs. 15 classifiers), we could have reduced this set
even further since, in the end, only XGBoost models ended up in the final ensembles for
the challenge.</p>
<p>.quote_author[Feurer et al, PoSH auto-sklearn]</p>
</div>
<div class="section" id="dabl">
<h2>dabl<a class="headerlink" href="#dabl" title="Permalink to this headline">¶</a></h2>
<div class="section" id="https-dabl-github-io">
<h3>https://dabl.github.io/<a class="headerlink" href="#https-dabl-github-io" title="Permalink to this headline">¶</a></h3>
<p>Implements a portfolio classfier with successive halving:</p>
<p><img alt=":scale 100%" src="../_images/anyclassifier.png" /></p>
</div>
</div>
<div class="section" id="questions">
<h2>Questions ?<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)}</span>
<span class="n">param_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;gamma&#39;: array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02, 1.e+03]),
 &#39;C&#39;: array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02, 1.e+03])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tot_time</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">train_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]</span>
<span class="k">for</span> <span class="n">train_size</span> <span class="ow">in</span> <span class="n">train_sizes</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span> <span class="o">/</span> <span class="mf">16.</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">)</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVC</span><span class="p">(),</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">iid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">tot_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;param_C&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;param_gamma&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="stderr docutils container">
<pre class="stderr literal-block">/home/andy/checkout/scikit-learn/sklearn/model_selection/_split.py:2184: FutureWarning: From version 0.21, test_size will always complement train_size unless both are specified.
  FutureWarning)
/home/andy/checkout/scikit-learn/sklearn/model_selection/_split.py:2184: FutureWarning: From version 0.21, test_size will always complement train_size unless both are specified.
  FutureWarning)
/home/andy/checkout/scikit-learn/sklearn/model_selection/_split.py:2184: FutureWarning: From version 0.21, test_size will always complement train_size unless both are specified.
  FutureWarning)
/home/andy/checkout/scikit-learn/sklearn/model_selection/_split.py:2184: FutureWarning: From version 0.21, test_size will always complement train_size unless both are specified.
  FutureWarning)
</pre>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=.</span><span class="mi">99</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Data fraction: </span><span class="si">{}</span><span class="s2">% time: </span><span class="si">{:.0f}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">tot_time</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">param_grid</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;RBF-SVM parameters on digits dataset&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;images/multi-fidelity-digits.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/parameter_tuning_automl_43_0.png" src="../_images/parameter_tuning_automl_43_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="n-estimators-in-random-forest">
<h1>n_estimators in Random Forest<a class="headerlink" href="#n-estimators-in-random-forest" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_features</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">digits</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">digits</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">get_depth</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>19
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid_rf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]}</span>
<span class="n">tot_time_rf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">results_rf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">n_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">]</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span> <span class="o">/</span> <span class="mf">16.</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n_ests</span> <span class="ow">in</span> <span class="n">n_estimators</span><span class="p">:</span>
    <span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">n_ests</span><span class="p">),</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid_rf</span><span class="p">,</span> <span class="n">iid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">tot_time_rf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;param_max_depth&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;param_max_features&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">)</span>
    <span class="n">results_rf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">results_rf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=.</span><span class="mi">85</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=.</span><span class="mi">98</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;n_estimators: </span><span class="si">{}</span><span class="s2"> time: </span><span class="si">{:.0f}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_estimators</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">tot_time_rf</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_grid_rf</span><span class="p">[</span><span class="s1">&#39;max_features&#39;</span><span class="p">])))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">param_grid_rf</span><span class="p">[</span><span class="s1">&#39;max_features&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;max_features&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_grid_rf</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">])))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">param_grid_rf</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;max_depth&#39;</span><span class="p">)</span>
<span class="c1">#plt.colorbar(im, ax=axes)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Random Forest parameters on digits dataset&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;images/multi-fidelity-digits-rf.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/parameter_tuning_automl_47_0.png" src="../_images/parameter_tuning_automl_47_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>13.287712379549449
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span>  <span class="nn">civismlext</span> <span class="kn">import</span> <span class="n">HyperbandSearchCV</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># build a classifier</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="c1"># Utility function to report best scores</span>
<span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">n_top</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_top</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;rank_test_score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model with rank: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean validation score: </span><span class="si">{0:.3f}</span><span class="s2"> (std: </span><span class="si">{1:.3f}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                  <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">][</span><span class="n">candidate</span><span class="p">],</span>
                  <span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_test_score&#39;</span><span class="p">][</span><span class="n">candidate</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameters: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="n">candidate</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="c1"># specify parameters and distributions to sample from</span>
<span class="n">param_dist</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
              <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="n">sp_randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
              <span class="s2">&quot;min_samples_split&quot;</span><span class="p">:</span> <span class="n">sp_randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
              <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
              <span class="s2">&quot;criterion&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gini&quot;</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span><span class="p">]}</span>



<span class="c1"># use a full grid over all parameters</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
              <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
              <span class="s2">&quot;min_samples_split&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
              <span class="s2">&quot;bootstrap&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
              <span class="s2">&quot;criterion&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gini&quot;</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hp</span> <span class="o">=</span> <span class="n">HyperbandSearchCV</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dist</span><span class="p">,</span> <span class="n">cost_parameter_max</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">halving</span> <span class="kn">import</span> <span class="n">GridSuccessiveHalving</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">GridSuccessiveHalving</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successive Halving took </span><span class="si">%.2f</span><span class="s2"> seconds for </span><span class="si">%d</span><span class="s2"> candidate parameter settings.&quot;</span>
      <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">])))</span>
<span class="n">report</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>7
n_samples_iter: 100
n_samples_iter: 100
</pre></div>
</div>
<div class="stderr docutils container">
<pre class="stderr literal-block">/home/andy/checkout/scikit-learn/sklearn/model_selection/_split.py:643: Warning: The least populated class in y has only 4 members, which is too few. The minimum number of members in any class cannot be less than n_splits=5.
  % (min_groups, self.n_splits)), Warning)
</pre>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>n_samples_iter: 100
</pre></div>
</div>
<div class="stderr docutils container">
<pre class="stderr literal-block">/home/andy/checkout/scikit-learn/sklearn/model_selection/_split.py:643: Warning: The least populated class in y has only 3 members, which is too few. The minimum number of members in any class cannot be less than n_splits=5.
  % (min_groups, self.n_splits)), Warning)
</pre>
</div>
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>n_samples_iter: 100
n_samples_iter: 100
n_samples_iter: 100
n_samples_iter: 100
Successive Halving took 12.32 seconds for 145 candidate parameter settings.
Model with rank: 1
Mean validation score: 0.885 (std: 0.035)
Parameters: {&#39;bootstrap&#39;: False, &#39;criterion&#39;: &#39;gini&#39;, &#39;max_depth&#39;: None, &#39;max_features&#39;: 10, &#39;min_samples_split&#39;: 3}

Model with rank: 2
Mean validation score: 0.875 (std: 0.064)
Parameters: {&#39;bootstrap&#39;: False, &#39;criterion&#39;: &#39;entropy&#39;, &#39;max_depth&#39;: None, &#39;max_features&#39;: 10, &#39;min_samples_split&#39;: 3}

Model with rank: 3
Mean validation score: 0.866 (std: 0.072)
Parameters: {&#39;bootstrap&#39;: False, &#39;criterion&#39;: &#39;entropy&#39;, &#39;max_depth&#39;: None, &#39;max_features&#39;: 3, &#39;min_samples_split&#39;: 3}

</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sh</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.9594285714285714
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># run randomized search</span>
<span class="n">n_iter_search</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_dist</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter_search</span><span class="p">,</span> <span class="n">iid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RandomizedSearchCV took </span><span class="si">%.2f</span><span class="s2"> seconds for </span><span class="si">%d</span><span class="s2"> candidates&quot;</span>
      <span class="s2">&quot; parameter settings.&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">),</span> <span class="n">n_iter_search</span><span class="p">))</span>
<span class="n">report</span><span class="p">(</span><span class="n">random_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#.groupby(&quot;params&quot;).plot(x=&quot;iter&quot;, y=&quot;mean_test_score&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">random_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.9583428571428572
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;params_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">reshape</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;params_str&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">)</span>
<span class="n">reshape</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2b0164a7b8&gt;
</pre></div>
</div>
<img alt="../_images/parameter_tuning_automl_58_1.png" src="../_images/parameter_tuning_automl_58_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">res</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;params_str&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_test_score&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;images/halving_curve.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/parameter_tuning_automl_59_0.png" src="../_images/parameter_tuning_automl_59_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">res</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_test_score&#39;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f0196c080f0&gt;
</pre></div>
</div>
<img alt="../_images/parameter_tuning_automl_60_1.png" src="../_images/parameter_tuning_automl_60_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="stderr docutils container">
<pre class="stderr literal-block">/home/andy/checkout/scikit-learn/sklearn/model_selection/_split.py:2184: FutureWarning: From version 0.21, test_size will always complement train_size unless both are specified.
  FutureWarning)
</pre>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>
<span class="n">param_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;gamma&#39;: array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02]),
 &#39;C&#39;: array([1.e-03, 1.e-02, 1.e-01, 1.e+00, 1.e+01, 1.e+02])}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># run grid search</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVC</span><span class="p">(),</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">iid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GridSearchCV took </span><span class="si">%.2f</span><span class="s2"> seconds for </span><span class="si">%d</span><span class="s2"> candidate parameter settings.&quot;</span>
      <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">])))</span>
<span class="n">report</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">sh</span> <span class="o">=</span> <span class="n">GridSuccessiveHalving</span><span class="p">(</span><span class="n">SVC</span><span class="p">(),</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">sh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Successive Halving took </span><span class="si">%.2f</span><span class="s2"> seconds for </span><span class="si">%d</span><span class="s2"> candidate parameter settings.&quot;</span>
      <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">])))</span>
<span class="n">report</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grid_search</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.9194666666666667
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sh</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0.9187536231884058
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;params_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">reshape</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;params_str&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">)</span>
<span class="n">reshape</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f48ffb91898&gt;
</pre></div>
</div>
<img alt="../_images/parameter_tuning_automl_67_1.png" src="../_images/parameter_tuning_automl_67_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reshape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>params_str</th>
      <th>{'C': 0.001, 'gamma': 0.001}</th>
      <th>{'C': 0.001, 'gamma': 0.01}</th>
      <th>{'C': 0.001, 'gamma': 0.1}</th>
      <th>{'C': 0.001, 'gamma': 1.0}</th>
      <th>{'C': 0.001, 'gamma': 10.0}</th>
      <th>{'C': 0.001, 'gamma': 100.0}</th>
      <th>{'C': 0.01, 'gamma': 0.001}</th>
      <th>{'C': 0.01, 'gamma': 0.01}</th>
      <th>{'C': 0.01, 'gamma': 0.1}</th>
      <th>{'C': 0.01, 'gamma': 1.0}</th>
      <th>...</th>
      <th>{'C': 10.0, 'gamma': 0.1}</th>
      <th>{'C': 10.0, 'gamma': 1.0}</th>
      <th>{'C': 10.0, 'gamma': 10.0}</th>
      <th>{'C': 10.0, 'gamma': 100.0}</th>
      <th>{'C': 100.0, 'gamma': 0.001}</th>
      <th>{'C': 100.0, 'gamma': 0.01}</th>
      <th>{'C': 100.0, 'gamma': 0.1}</th>
      <th>{'C': 100.0, 'gamma': 1.0}</th>
      <th>{'C': 100.0, 'gamma': 10.0}</th>
      <th>{'C': 100.0, 'gamma': 100.0}</th>
    </tr>
    <tr>
      <th>iter</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.164668</td>
      <td>0.164668</td>
      <td>0.129374</td>
      <td>0.129374</td>
      <td>0.164668</td>
      <td>0.141138</td>
      <td>0.164668</td>
      <td>0.164668</td>
      <td>0.129374</td>
      <td>0.129374</td>
      <td>...</td>
      <td>0.277687</td>
      <td>0.129374</td>
      <td>0.164668</td>
      <td>0.141138</td>
      <td>0.751719</td>
      <td>0.766145</td>
      <td>0.277687</td>
      <td>0.129374</td>
      <td>0.164668</td>
      <td>0.141138</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.162487</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.162487</td>
      <td>0.162487</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>0.304140</td>
      <td>NaN</td>
      <td>0.162487</td>
      <td>NaN</td>
      <td>0.732745</td>
      <td>0.733937</td>
      <td>0.304140</td>
      <td>NaN</td>
      <td>0.162487</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>0.293254</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.740079</td>
      <td>0.776190</td>
      <td>0.293254</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.780840</td>
      <td>0.800602</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.880104</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.895587</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 36 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bla</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;params_str&#39;</span><span class="p">)[</span><span class="s1">&#39;mean_test_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;params_str&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)[[</span><span class="s1">&#39;param_gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;param_C&#39;</span><span class="p">,</span> <span class="s1">&#39;mean_test_score&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;param_C&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;param_gamma&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="6" halign="left">mean_test_score</th>
    </tr>
    <tr>
      <th>param_gamma</th>
      <th>0.001</th>
      <th>0.010</th>
      <th>0.100</th>
      <th>1.000</th>
      <th>10.000</th>
      <th>100.000</th>
    </tr>
    <tr>
      <th>param_C</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.001</th>
      <td>0.162487</td>
      <td>0.164668</td>
      <td>0.129374</td>
      <td>0.129374</td>
      <td>0.164668</td>
      <td>0.141138</td>
    </tr>
    <tr>
      <th>0.010</th>
      <td>0.162487</td>
      <td>0.162487</td>
      <td>0.129374</td>
      <td>0.129374</td>
      <td>0.162487</td>
      <td>0.141138</td>
    </tr>
    <tr>
      <th>0.100</th>
      <td>0.162487</td>
      <td>0.164668</td>
      <td>0.129374</td>
      <td>0.129374</td>
      <td>0.162487</td>
      <td>0.141138</td>
    </tr>
    <tr>
      <th>1.000</th>
      <td>0.182540</td>
      <td>0.846617</td>
      <td>0.293254</td>
      <td>0.129374</td>
      <td>0.162487</td>
      <td>0.141138</td>
    </tr>
    <tr>
      <th>10.000</th>
      <td>0.785551</td>
      <td>0.895587</td>
      <td>0.293254</td>
      <td>0.129374</td>
      <td>0.162487</td>
      <td>0.141138</td>
    </tr>
    <tr>
      <th>100.000</th>
      <td>0.780840</td>
      <td>0.895587</td>
      <td>0.293254</td>
      <td>0.129374</td>
      <td>0.162487</td>
      <td>0.141138</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;param_C&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;param_gamma&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f48feefe908&gt;
</pre></div>
</div>
<img alt="../_images/parameter_tuning_automl_72_1.png" src="../_images/parameter_tuning_automl_72_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;params_str&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)[[</span><span class="s1">&#39;param_gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;param_C&#39;</span><span class="p">,</span> <span class="s1">&#39;iter&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;param_C&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;param_gamma&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="6" halign="left">iter</th>
    </tr>
    <tr>
      <th>param_gamma</th>
      <th>0.001</th>
      <th>0.010</th>
      <th>0.100</th>
      <th>1.000</th>
      <th>10.000</th>
      <th>100.000</th>
    </tr>
    <tr>
      <th>param_C</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.001</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>0.010</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>0.100</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.000</th>
      <td>2</td>
      <td>4</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10.000</th>
      <td>3</td>
      <td>5</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>100.000</th>
      <td>3</td>
      <td>5</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">LogisticRegressionCV</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">LogisticRegressionCV</span><span class="p">(</span><span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;multinomial&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;sag&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([  0.001,   0.01 ,   0.1  ,   1.   ,  10.   , 100.   ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">27</span> <span class="o">*</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>81
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_params</span> <span class="o">=</span> <span class="mi">81</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">eta</span> <span class="o">=</span> <span class="mf">3.</span>
<span class="n">budget</span> <span class="o">=</span> <span class="mi">23000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_params</span> <span class="o">*</span> <span class="n">n_samples</span> <span class="o">*</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">**</span> <span class="o">-</span><span class="n">l</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">budget</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">s</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resources_spent</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">n_params_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_params</span><span class="o">*</span><span class="n">eta</span> <span class="o">**</span> <span class="o">-</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_params_left</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">resources</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n_samples</span> <span class="o">*</span> <span class="n">eta</span> <span class="o">**</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span>
    <span class="n">resources_spent</span> <span class="o">+=</span> <span class="n">n_params_left</span> <span class="o">*</span> <span class="n">resources</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;train </span><span class="si">{}</span><span class="s2"> configurations with resources </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_params_left</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">resources</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;resources total: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resources_spent</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>train 81 configurations with resources 41
train 27 configurations with resources 123
train 9 configurations with resources 370
train 3 configurations with resources 1111
train 1 configurations with resources 3333
resources total: 16638.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">k</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>16
</pre></div>
</div>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="17-cluster-evaluation.html" title="previous page">Cluster Stability</a>
    <a class='right-next' id="next-link" href="../05-advanced-topics/index.html" title="next page">Advanced Topics</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Andreas C. Müller<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>